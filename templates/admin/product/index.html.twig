{% extends 'base.html.twig' %}

{% block title %}Admin — Produits{% endblock %}

{% block stylesheets %}
    <style>
        body { margin:0; font-family:"Helvetica Neue", Arial, sans-serif; background:#f8f9fb; color:#0f172a; }
        .wrapper { max-width: 1100px; margin: 0 auto; padding: 32px 20px; }
        header { display:flex; justify-content: space-between; align-items:center; flex-wrap:wrap; gap:12px; margin-bottom:20px; }
        h1 { margin:0; font-size:24px; }
        a { color: inherit; text-decoration: none; }
        .pill { display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius: 999px; background:#0f172a; color:#fff; font-weight:700; }
        .panel { background:#fff; border:1px solid rgba(0,0,0,0.06); border-radius:12px; padding:16px; }
        table { width:100%; border-collapse: collapse; }
        th, td { padding:10px 8px; border-bottom:1px solid rgba(0,0,0,0.05); text-align:left; }
        th { font-size:13px; color:#6b7280; font-weight:700; text-transform: uppercase; letter-spacing:0.02em; }
        .badge { display:inline-block; padding:4px 8px; border-radius:8px; background:#e5e7eb; font-size:12px; }
        .actions { display:flex; gap:8px; flex-wrap:wrap; }
        .btn-secondary { padding:6px 10px; border-radius:10px; background:#eef2ff; color:#312e81; font-weight:600; border:1px solid #c7d2fe; }
        .btn-danger { padding:6px 10px; border-radius:10px; background:#fee2e2; color:#991b1b; font-weight:600; border:1px solid #fecdd3; }
        .muted { color:#6b7280; font-size:14px; }
        .flash { padding:10px 12px; border-radius:10px; background:#ecfdf3; color:#065f46; border:1px solid #bbf7d0; margin-bottom:12px; }
        img.thumb { width:56px; height:56px; object-fit:cover; border-radius:10px; border:1px solid rgba(0,0,0,0.05); }
        @media (max-width: 760px) {
            .table-wrapper { overflow-x:auto; }
            th, td { white-space: nowrap; }
        }
    </style>
{% endblock %}

{% block body %}
<div class="wrapper">
    <header>
        <h1>Produits</h1>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <a class="pill" href="{{ path('admin_dashboard') }}">← Tableau de bord</a>
            <a class="pill" href="{{ path('shop_home') }}" style="background:#111827;">Voir la boutique</a>
            <a class="pill" href="{{ path('admin_product_new') }}" style="background:#2563eb;">+ Nouveau produit</a>
        </div>
    </header>

    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div class="flash">{{ message }}</div>
        {% endfor %}
    {% endfor %}

    <div class="panel table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Visuel</th>
                    <th>Nom</th>
                    <th>Prix</th>
                    <th>Promo</th>
                    <th>Badge</th>
                    <th style="text-align:right;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for product in products %}
                    <tr>
                        <td>
                            {% if product.imageUrl %}
                                <img class="thumb" src="{{ product.imageUrl }}" alt="{{ product.name }}">
                            {% else %}
                                <span class="muted">—</span>
                            {% endif %}
                        </td>
                        <td>{{ product.name }}</td>
                        <td>{{ product.price }} €</td>
                        <td>
                            {% if product.promoPercent is not null %}
                                -{{ product.promoPercent }}%
                            {% else %}
                                <span class="muted">—</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if product.badge %}
                                <span class="badge">{{ product.badge }}</span>
                            {% else %}
                                <span class="muted">—</span>
                            {% endif %}
                        </td>
                        <td style="text-align:right;">
                            <div class="actions">
                                <a class="btn-secondary" href="{{ path('admin_product_edit', {id: product.id}) }}">Éditer</a>
                                <form method="post" action="{{ path('admin_product_delete', {id: product.id}) }}" onsubmit="return confirm('Supprimer ce produit ?');">
                                    <input type="hidden" name="_token" value="{{ csrf_token('delete_product_' ~ product.id) }}">
                                    <button class="btn-danger" type="submit">Supprimer</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="6" class="muted">Aucun produit pour l’instant.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
